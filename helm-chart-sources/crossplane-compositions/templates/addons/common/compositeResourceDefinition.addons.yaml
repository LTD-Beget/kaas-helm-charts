{{- define "addons.common.compositeResourceDefinition" }}
{{- if not .root.Values.composition.developmentMode }}
  {{- $name := printf "%s" .name }}
  {{- $singular := $name | lower}}
  {{- $singularCamel := include "camelLower" $name }}
  {{- $singularKebab := kebabcase $name }}
  {{- $singularSnake := snakecase $name }}
  {{- $pluralName := printf "%ss" $name }}
  {{- $plural := printf "%ss" $singular }}
  {{- $pluralCamel := printf "%ss" $singularCamel }}
  {{- $pluralKebab := printf "%ss" $singularKebab }}
  {{- $pluralSnake := printf "%ss" $singularSnake }}

---
apiVersion: apiextensions.crossplane.io/v1
kind: CompositeResourceDefinition
metadata:
  name: xaddons{{ $plural }}.in-cloud.io
spec:
  group: in-cloud.io
  names:
    kind: XAddons{{ $name }}
    plural: xaddons{{ $plural }}
    singular: xaddons{{ $singular }}
  claimNames:
    kind: Addons{{ $name }}Claim
    plural: addons{{ $singular }}claims
    singular: addons{{ $singular }}claim
  versions:
    - name: v1alpha1
      referenceable: true
      served: true
      schema:
        openAPIV3Schema:
          description: XAddons{{ $name }} is the Schema for the xaddons{{ $singular }} API.
          type: object
          required:
            - spec
          properties:
            metadata:
              type: object
              x-kubernetes-preserve-unknown-fields: true
            spec:
              type: object
              x-kubernetes-preserve-unknown-fields: true
              properties:
                argocd:
                  type: object
                  properties:
                    chart:
                      type: string
                      description: The chart of the argocd application.
                    pluginName:
                      type: string
                      description: The name of the plugin.
                    destination:
                      type: object
                      properties:
                        name:
                          type: string
                          description: The name of the destination.
                        namespace:
                          type: string
                          description: The namespace of the destination.
                    namespace:
                      type: string
                      description: The namespace of the argocd application.
                    path:
                      type: string
                      description: The path of the argocd application.
                    project:
                      type: string
                      description: The project of the argocd application.
                    releaseName:
                      type: string
                      description: The release name of the argocd application.
                    repoURL:
                      type: string
                      description: The repoURL of the argocd application.
                    targetRevision:
                      type: string
                      description: The targetRevision of the argocd application.
                    trackingID:
                      type: string
                      description: The tracking ID of the argocd application.
                cluster:
                  type: object
                  description: Defines the name of Cluster.
                  properties:
                    name:
                      type: string
                      description: The name of the cluster.
                    host:
                      type: string
                      description: The host of the cluster.
                    port:
                      type: integer
                      description: The port of the cluster.
                    xcluster:
                      type: string
                      description: Defines the name of XCluster.
                providerConfigRef:
                  type: object
                  properties:
                    name:
                      type: string
                      description: The name of the provider config.
                values:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                version:
                  type: string
                  description: The version of the addon.
            status:
              type: object
              x-kubernetes-preserve-unknown-fields: true
              properties:
                health:
                  type: string
                  description: The health status of the addon.
                deployed:
                  type: string
                  description: The deployed status of the addon.
{{- end }}
{{- end }}