{{- if .Values.xK8s.enabled }}
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: xworkergroups.cluster.x-k8s.io
spec:
  conversion:
    strategy: None
  group: cluster.x-k8s.io
  names:
    categories:
      - composite
    kind: XWorkerGroup
    listKind: XWorkerGroupList
    plural: xworkergroups
    shortNames:
      - xwg
    singular: xworkergroup
  scope: Cluster
  versions:
    - additionalPrinterColumns:
        - jsonPath: .status.conditions[?(@.type=='Synced')].status
          name: SYNCED
          type: string
        - jsonPath: .status.conditions[?(@.type=='Ready')].status
          name: READY
          type: string
        - jsonPath: .spec.compositionRef.name
          name: COMPOSITION
          type: string
        - jsonPath: .spec.compositionRevisionRef.name
          name: COMPOSITIONREVISION
          priority: 1
          type: string
        - jsonPath: .metadata.creationTimestamp
          name: AGE
          type: date
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: XWorkerGroup is the Schema for the xworkergroup API.
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              properties:
                name:
                  maxLength: 63
                  type: string
              type: object
            spec:
              properties:
                claimRef:
                  properties:
                    apiVersion:
                      type: string
                    kind:
                      type: string
                    name:
                      type: string
                    namespace:
                      type: string
                  required:
                    - apiVersion
                    - kind
                    - namespace
                    - name
                  type: object
                compositionRef:
                  properties:
                    name:
                      type: string
                  required:
                    - name
                  type: object
                compositionRevisionRef:
                  properties:
                    name:
                      type: string
                  required:
                    - name
                  type: object
                compositionRevisionSelector:
                  properties:
                    matchLabels:
                      additionalProperties:
                        type: string
                      type: object
                  required:
                    - matchLabels
                  type: object
                compositionSelector:
                  properties:
                    matchLabels:
                      additionalProperties:
                        type: string
                      type: object
                  required:
                    - matchLabels
                  type: object
                compositionUpdatePolicy:
                  default: Automatic
                  enum:
                    - Automatic
                    - Manual
                  type: string
                parameters:
                  description: WorkerGroupSpec defines the desired state of WorkerGroup.
                  properties:
                    beget_clt_region:
                      description: Beget region.
                      type: string
                    beget_vmt_dp_configuration_name:
                      description: Beget data plane configuration name.
                      type: string
                    clusterName:
                      description: Name of the cluster.
                      type: string
                    configuration:
                      description: Configuration of workergroup.
                      properties:
                        cpuCount:
                          description: CPU count.
                          type: integer
                        diskSize:
                          description: Disk size.
                          type: integer
                        memory:
                          description: Memory.
                          type: integer
                      type: object
                    image:
                      description: Name of the golden image.
                      type: string
                    kubeletConfiguration:
                      description: Kubelet configuration override to merge into config-custom.yaml in workergroup.
                      properties:
                        clusterDNS:
                          description: Cluster DNS address.
                          type: string
                        clusterDomain:
                          description: Cluster DNS domain name.
                          type: string
                        cpuCFSQuota:
                          description: Whether to enforce CFS quota on CPU usage.
                          type: boolean
                        evictionHard:
                          additionalProperties:
                            type: string
                          description: |
                            Thresholds for hard eviction. Example: { "memory.available": "200Mi" }
                          type: object
                        evictionMaxPodGracePeriod:
                          description: The maximum grace period (in seconds) allowed for pod termination during eviction.
                          type: integer
                        evictionMinimumReclaim:
                          additionalProperties:
                            type: string
                          description: Minimum reclaimable resources before eviction starts.
                          type: object
                        evictionPressureTransitionPeriod:
                          description: The duration (in Duration format, e.g., "5m" or "1h") before transitioning out of an eviction pressure condition. Default is "5m".
                          type: string
                        evictionSoft:
                          additionalProperties:
                            type: string
                          description: |
                            Thresholds for soft eviction. Example: { "memory.available": "300Mi" }
                          type: object
                        evictionSoftGracePeriod:
                          additionalProperties:
                            type: string
                          description: |
                            Grace periods for soft eviction signals. Example: { "memory.available": "30s" }
                          type: object
                        imageGCHighThresholdPercent:
                          description: The high threshold for image garbage collection based on disk usage percentage.
                          type: integer
                        imageGCLowThresholdPercent:
                          description: The low threshold for image garbage collection based on disk usage percentage.
                          type: integer
                        imageMaximumGCAge:
                          description: The maximum age of images before garbage collection happens (e.g., "24h").
                          type: string
                        imageMinimumGCAge:
                          description: The minimum age of images before garbage collection starts (e.g., "2h").
                          type: string
                        kubeReserved:
                          description: Resources reserved for Kubernetes components such as Kubelet, Scheduler, Controller Manager, etc.
                          properties:
                            cpu:
                              description: Amount of CPU resources reserved for Kubernetes components (e.g., "500m").
                              type: string
                            memory:
                              description: Amount of memory resources reserved for Kubernetes components (e.g., "1Gi").
                              type: string
                          type: object
                        maxPods:
                          description: Max number of pods per node.
                          type: integer
                        mergeDefaultEvictionSettings:
                          description: Whether to merge default eviction settings from the Kubelet's configuration.
                          type: boolean
                        shutdownGracePeriod:
                          description: The grace period (in Duration format, e.g., "30s" or "1m") before Kubelet terminates the node during shutdown.
                          type: string
                        systemReserved:
                          additionalProperties:
                            type: string
                          description: Resources reserved for system components on the node (e.g., OS-level daemons).
                          type: object
                      type: object
                    labels:
                      additionalProperties:
                        type: string
                      description: Labels of workergroup.
                      type: object
                    networkTag:
                      description: Network tag.
                      type: string
                    replicas:
                      description: Number of workergroup replicas.
                      type: integer
                    serverName:
                      description: Beget host serverName.
                      type: string
                    taints:
                      description: Taints of workergroup.
                      items:
                        properties:
                          effect:
                            type: string
                          key:
                            type: string
                          value:
                            type: string
                        type: object
                      type: array
                    usePrivateNetwork:
                      description: usePrivateNetwork on VM.
                      type: boolean
                    version:
                      description: The Kubernetes version of the cluster.
                      type: string
                    xcluster:
                      description: Name of core composition xcluster.
                      type: string
                  type: object
                publishConnectionDetailsTo:
                  properties:
                    configRef:
                      default:
                        name: default
                      properties:
                        name:
                          type: string
                      type: object
                    metadata:
                      properties:
                        annotations:
                          additionalProperties:
                            type: string
                          type: object
                        labels:
                          additionalProperties:
                            type: string
                          type: object
                        type:
                          type: string
                      type: object
                    name:
                      type: string
                  required:
                    - name
                  type: object
                resourceRefs:
                  items:
                    properties:
                      apiVersion:
                        type: string
                      kind:
                        type: string
                      name:
                        type: string
                    required:
                      - apiVersion
                      - kind
                    type: object
                  type: array
                  x-kubernetes-list-type: atomic
                writeConnectionSecretToRef:
                  properties:
                    name:
                      type: string
                    namespace:
                      type: string
                  required:
                    - name
                    - namespace
                  type: object
              required:
                - parameters
              type: object
            status:
              properties:
                claimConditionTypes:
                  items:
                    type: string
                  type: array
                  x-kubernetes-list-type: set
                conditions:
                  description: Conditions of the resource.
                  items:
                    properties:
                      lastTransitionTime:
                        format: date-time
                        type: string
                      message:
                        type: string
                      reason:
                        type: string
                      status:
                        type: string
                      type:
                        type: string
                    required:
                      - lastTransitionTime
                      - reason
                      - status
                      - type
                    type: object
                  type: array
                  x-kubernetes-list-map-keys:
                    - type
                  x-kubernetes-list-type: map
                connectionDetails:
                  properties:
                    lastPublishedTime:
                      format: date-time
                      type: string
                  type: object
                machineDeploymentStatus:
                  properties:
                    desiredReplicas:
                      type: integer
                    v1beta2:
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                  type: object
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
      subresources:
        status: {}
{{- end }}
