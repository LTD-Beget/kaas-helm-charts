{{- range $appName, $appValue := .Values.applications }}
  {{- if $appValue.enabled }}
    {{- if and $appValue.monitoring.enabled (eq $appValue.monitoring.type "VictoriaMetrics") }}
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMServiceScrape
metadata:
  name: controller-manager-client
  namespace: beget-system
spec:
  endpoints:
    - port: https-metrics
      scheme: "https"
      tlsConfig:
        serverName: {{ $appValue.clusterName }}-controller-manager
        ca:
          secret:
            name: {{ $appValue.clusterName }}-ca-crt
            key: ca.crt
  selector:
    matchLabels:
      component: kube-controller-manager-client
  jobLabel: jobLabel
    {{- end }}
  {{- end }}
{{- end }}