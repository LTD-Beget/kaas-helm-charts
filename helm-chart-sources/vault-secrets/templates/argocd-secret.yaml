{{- if and .Values.argocd.enabled .Values.argocd.repositories }}
{{- range $r := .Values.argocd.repositories }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ required "argocd.repositories[].name is required" $r.name }}
  namespace: {{ required "argocd.repositories[].namespace is required" $r.namespace }}
  labels:
    argocd.argoproj.io/secret-type: repository
type: Opaque
stringData:
  url: {{ required "argocd.repositories[].url is required" $r.url | quote }}
  username: "<path:{{ $r.auth.vaultPath }}#{{ default "username" $r.auth.usernameKey }}>"
  password: "<path:{{ $r.auth.vaultPath }}#{{ default "password" $r.auth.passwordKey }}>"
{{- end }}
{{- end }}