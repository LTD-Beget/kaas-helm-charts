grafana:
  name: grafana
  labels:
    app.kubernetes.io/name: grafana
  spec:
    config:
      log:
        mode: "console"
      auth:
        disable_login_form: "false"
      security:
        admin_user: "admin"
        admin_password: "supersecret"
    deployment:
      spec:
        template:
          spec:
            tolerations: []
            priorityClassName: ""
            containers:
              - name: grafana
                image: grafana/grafana:11.3.0
                securityContext:
                  allowPrivilegeEscalation: true
                  readOnlyRootFilesystem: false
                readinessProbe:
                  failureThreshold: 3
                resources:
                  requests:
                    cpu: 200m
                    memory: 500Mi
                  limits:
                    cpu: 1
                    memory: 2Gi
              - name: rbac-proxy
                image: gcr.io/kubebuilder/kube-rbac-proxy:v0.14.4
                args:
                  - --secure-listen-address=0.0.0.0:11043
                  - --upstream=http://127.0.0.1:9402
                  - --tls-cert-file=/app/config/metrics/tls/tls.crt
                  - --tls-private-key-file=/app/config/metrics/tls/tls.key
                  - --v=2
                ports:
                  - name: https-metrics
                    containerPort: 11043
                    protocol: TCP
                resources:
                  requests:
                    memory: "32Mi"
                    cpu: "10m"
                  limits:
                    memory: "64Mi"
                    cpu: "50m"
                volumeMounts:
                  - name: rbac-proxy-tls
                    mountPath: /app/config/metrics/tls
                    readOnly: true
            volumes:
            - name: rbac-proxy-tls
              secret:
                defaultMode: 420
                secretName: grafana-monitoring-svc-tls

monitoring:
  enabled: false
  type: VictoriaMetrics
  namespace: default
  secureService:
    enabled: false
    # Create a secret containing both 'tls.crt' and 'tls.key' fields
    issuer:
      kind: ClusterIssuer
      name: default

istio:
  virtualService:
    enabled: false
    gateways:
      - default-ns/default
    hosts:
      - "*"
    http:
      name: grafana
      route:
        host: grafana-service
        port: 3000