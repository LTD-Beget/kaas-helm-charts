{{- if .Values.monitoring.vmServiceScrape.enabled }}
---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMServiceScrape
metadata:
  name: {{ include "capi-kubeadm-control-plane.fullname" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "capi-kubeadm-control-plane.labels" . | nindent 4 }}
spec:
  endpoints:
  - path: /metrics
    port: metrics
    scheme: HTTPS
    bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
    tlsConfig:
      serverName: localhost
  {{- if not .Values.certificates.useExternalIssuer }}
      insecureSkipVerify: true
  {{- end }}
  jobLabel: {{ include "capi-kubeadm-control-plane.fullname" . }}
  selector:
    matchLabels:
      monitoring.in-cloud.io/service: {{ include "capi-kubeadm-control-plane.fullname" . }}-metrics-service
      {{- include "capi-kubeadm-control-plane.selectorLabels" . | nindent 6 }}
{{- end }}
